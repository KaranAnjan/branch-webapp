<!DOCTYPE html>
<html>
<head>
  <title>Branch Data Web App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
      line-height: 1.6;
    }
    h2, h3 {
      text-align: center;
    }
    .tabs {
      text-align: center;
      margin-bottom: 20px;
    }
    .tabs button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      border: none;
      cursor: pointer;
    }
    .tabs button.active {
      background-color: #00A651;
      color: white;
    }
    .tabs button:not(.active) {
      background-color: #eee;
      color: #333;
    }
    .tab {
      display: none;
    }
    .tab.active {
      display: block;
    }
    form {
      max-width: 400px;
      margin: 0 auto;
    }
    form input, form select {
      width: 100%;
      padding: 8px;
      margin: 5px 0 15px;
      font-size: 16px;
    }
    label {
      font-weight: bold;
    }
    select {
      font-size: 16px;
    }
	form h4 {
  margin-top: 20px;
  margin-bottom: 10px;
  color: #22265C;
  border-bottom: 2px solid #00A651;
  padding-bottom: 5px;
}

.submit-btn {
  background-color: #00A651;
  color: white;
  font-size: 18px;
  padding: 12px 20px;
  border: none;
  border-radius: 5px;
  width: 100%;
  cursor: pointer;
}

.submit-btn:hover {
  background-color: #008f46;
}
  </style>
</head>
<body>

  <h2>Branch Data Web App</h2>

  <div class="tabs">
    <button id="entryBtn" onclick="showTab('entry')">Data Entry</button>
    <button id="dashboardBtn" onclick="showTab('dashboard')">Dashboard</button>
  </div>

  <!-- DATA ENTRY TAB -->
  <div id="entry" class="tab">
    <h3>Data Entry</h3>
<form id="branchForm">
  <label>Branch Name:</label>
  <select name="branchName" required>
    <option value="">--Select Branch--</option>
    <option>Baghajatin</option>
    <option>Behala</option>
    <option>Dunlop</option>
    <option>Park Circus</option>
    <option>Rajarhat</option>
    <option>Taratala</option>
  </select>

  <h4>ðŸ“¦ Delivery Details</h4>
  <label>Retail Count:</label>
  <input type="number" name="retail">
  <label>Retail Value:</label>
  <input type="number" name="retailValue">
  <label>WS Count:</label>
  <input type="number" name="ws">
  <label>WS Value:</label>
  <input type="number" name="wsValue">

  <h4>ðŸ•‘ Pending Details</h4>
  <label>Retail Hold Count:</label>
  <input type="number" name="retailHold">
  <label>Retail Hold Value:</label>
  <input type="number" name="retailHoldValue">
  <label>WS Hold Count:</label>
  <input type="number" name="wsHold">
  <label>WS Hold Value:</label>
  <input type="number" name="wsHoldValue">

  <h4>ðŸ‘¥ Attendance</h4>
  <label>Attendance DB:</label>
  <input type="number" name="attendanceDB">
  <label>Attendance GH:</label>
  <input type="number" name="attendanceGH">
  <label>Attendance DLO:</label>
  <input type="number" name="attendanceDLO">

  <h4>ðŸšš Vehicle</h4>
  <label>Vehicle Use:</label>
  <input type="number" name="vehicleUse">
  <label>Van Use:</label>
  <input type="number" name="vanUse">

  <button type="submit" class="submit-btn">Submit</button>
</form>
  </div>

  <!-- DASHBOARD TAB -->
  <div id="dashboard" class="tab">
    <h3>Dashboard</h3>

    <div id="delivery_chart" style="width: 100%; height: 300px;"></div>
    <div id="hold_chart" style="width: 100%; height: 300px;"></div>

<!-- Attendance section -->
<h4>
  Attendance:
  <select id="attendanceSelector" onchange="drawAttendanceChart()">
    <option value="ALL">ALL</option>
    <option value="DB">DB</option>
    <option value="GH">GH</option>
    <option value="DLO">DLO</option>
  </select>
</h4>
<h5 id="attendance_chart_title">Attendance</h5>
<div id="attendance_chart" style="width: 100%; height: 300px;"></div>

<!-- Vehicle section -->
<h4>
  Vehicle:
  <select id="vehicleSelector" onchange="drawVehicleChart()">
    <option value="ALL">ALL</option>
    <option value="Vehicle Use">Vehicle Use</option>
    <option value="Van Use">Van Use</option>
  </select>
</h4>
<h5 id="vehicle_chart_title">Vehicle</h5>
<div id="vehicle_chart" style="width: 100%; height: 300px;"></div>


<script>
  const scriptURL = 'https://script.google.com/macros/s/AKfycbywerkpXiGd46-0c6Dm0N-Fq_mDH8gWr_OSqYObQ0nn3Dyxfh8vocf5zLWlFSOxjATv8A/exec'; // Replace with your Apps Script URL

  function showTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    document.getElementById(tabName).classList.add('active');

    // Update active button styles
    document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
    if (tabName === 'entry') {
      document.getElementById('entryBtn').classList.add('active');
    } else {
      document.getElementById('dashboardBtn').classList.add('active');
    }

    // If dashboard, draw charts
    if (tabName === 'dashboard') {
      drawCharts();
    }
  }

  // Handle form submit
  const form = document.getElementById('branchForm');
  form.addEventListener('submit', e => {
    e.preventDefault();
    const formData = new FormData(form);
    const data = {};
    formData.forEach((value, key) => { data[key] = value; });

    fetch(scriptURL, {
      method: 'POST',
      body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(res => {
      alert('Data submitted successfully!');
      form.reset();
    })
    .catch(err => {
      alert('Error submitting data');
      console.error(err);
    });
  });

  // Load Google Charts
  google.charts.load('current', {packages: ['corechart']});

  let globalData = [];

  function drawCharts() {
    fetch(scriptURL)
    .then(res => res.json())
    .then(data => {
      globalData = data;
      drawDeliveryChart();
      drawHoldChart();
      drawAttendanceChart();
      drawVehicleChart();
    });
  }

 function drawDeliveryChart() {
  const chartData = [['Branch', 'Retail Value', 'WS Value']];
  globalData.forEach(row => {
    chartData.push([row['Branch Name'], Number(row['Retail Value']), Number(row['WS Value'])]);
  });

  const dataTable = google.visualization.arrayToDataTable(chartData);
  const options = { 
    title: 'Delivery: Retail vs WS Value',
	legend: { position: 'top' },
    chartArea: {width: '60%'},
    colors: ['#00A651', '#22265C'],
    hAxis: { title: '', textPosition: 'out' },
    vAxis: { title: '', textPosition: 'out' }
  };
  const chart = new google.visualization.BarChart(document.getElementById('delivery_chart'));
  chart.draw(dataTable, options);
}

function drawHoldChart() {
  const chartData = [['Branch', 'Retail Hold Value', 'WS Hold Value']];
  globalData.forEach(row => {
    chartData.push([row['Branch Name'], Number(row['Retail Hold Value']), Number(row['WS Hold Value'])]);
  });

  const dataTable = google.visualization.arrayToDataTable(chartData);
  const options = { 
    title: 'Hold Delivery: Retail Hold vs WS Hold',
	legend: { position: 'top' },
    chartArea: {width: '60%'},
    colors: ['#00A651', '#22265C'],
    hAxis: { title: '', textPosition: 'out' },
    vAxis: { title: '', textPosition: 'out' }
  };
  const chart = new google.visualization.BarChart(document.getElementById('hold_chart'));
  chart.draw(dataTable, options);
}

function drawAttendanceChart() {
  const type = document.getElementById('attendanceSelector').value;

  // âœ… Chart title: Attendance ALL â†’ Attendance DB
  const chartTitle = document.getElementById('attendance_chart_title');
  chartTitle.innerText = type === 'ALL' ? 'Attendance' : `Attendance ${type}`;

  const chartData = [['Branch', 'Attendance']];
  globalData.forEach(row => {
    let value = 0;
    if (type === 'ALL') {
      value = Number(row['Attendance DB']) + Number(row['Attendance GH']) + Number(row['Attendance DLO']);
    } else {
      value = Number(row[`Attendance ${type}`]);
    }
    chartData.push([row['Branch Name'], value]);
  });

  const dataTable = google.visualization.arrayToDataTable(chartData);
  const options = {
    legend: 'none',
    chartArea: { width: '60%' },
    colors: ['#00A651'],
    hAxis: { title: '', textPosition: 'out' },
    vAxis: { title: '', textPosition: 'out' }
  };
  const chart = new google.visualization.ColumnChart(document.getElementById('attendance_chart'));
  chart.draw(dataTable, options);
}

function drawVehicleChart() {
  const type = document.getElementById('vehicleSelector').value;

  // âœ… Chart title: Vehicle ALL â†’ Vehicle Van Use
  const chartTitle = document.getElementById('vehicle_chart_title');
  chartTitle.innerText = type === 'ALL' ? 'Vehicle' : `Vehicle ${type}`;

  const chartData = [['Branch', 'Vehicle']];
  globalData.forEach(row => {
    let value = 0;
    if (type === 'ALL') {
      value = Number(row['Vehicle Use']) + Number(row['Van Use']);
    } else {
      value = Number(row[type]);
    }
    chartData.push([row['Branch Name'], value]);
  });

  const dataTable = google.visualization.arrayToDataTable(chartData);
  const options = {
    legend: 'none',
    chartArea: { width: '60%' },
    colors: ['#22265C'],
    hAxis: { title: '', textPosition: 'out' },
    vAxis: { title: '', textPosition: 'out' }
  };
  const chart = new google.visualization.ColumnChart(document.getElementById('vehicle_chart'));
  chart.draw(dataTable, options);
}

  // âœ… On page load: show dashboard by default
  window.onload = () => showTab('dashboard');

</script>

</body>
</html>
